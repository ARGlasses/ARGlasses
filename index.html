<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR glasses — Changing how you see the world</title>

    <!-- Your styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="images/logo7.png" type="image/png" />
  </head>
  <body>
    <!-- Header mount point -->
    <header id="site-header"></header>

    <!-- Page content -->
    <main class="container">
      <section class="hero">
        <h1>Welcome to AR Glasses</h1>
        <p>Discover the future of augmented reality.</p>
      </section>
      <!-- ... your content ... -->
    </main>

    <!-- Inject header.html, then init header.js; run fallback ONLY if header.js didn’t init -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const mount = document.getElementById("site-header");
        fetch("./header.html?v=6")
          .then(r => r.text())
          .then(html => {
            mount.innerHTML = html;

            // Primary init from header.js (if present and loaded)
            if (typeof window.__initHeader === "function") {
              try { window.__initHeader(); } catch (_) {}
            }

            // Fallback ONLY if header.js did not run
            if (!window.__headerInit) {
              (function bindFallback(){
                const menu     = document.getElementById("primary-nav");
                const toggle   = document.getElementById("menu-toggle");
                const backdrop = document.getElementById("backdrop");
                if (!menu || !toggle || !backdrop) return;

                const isMobile = () => window.matchMedia("(max-width: 768px)").matches;

                function openDrawer(){
                  menu.classList.add("open");
                  backdrop.classList.add("show");
                  toggle.setAttribute("aria-expanded","true");
                  document.body.style.overflow = "hidden";
                }
                function closeDrawer(){
                  menu.classList.remove("open");
                  backdrop.classList.remove("show");
                  toggle.setAttribute("aria-expanded","false");
                  document.body.style.overflow = "";
                  // collapse any open submenus
                  menu.querySelectorAll(".dropdown.open").forEach(li => li.classList.remove("open"));
                  menu.querySelectorAll(".submenu-toggle[aria-expanded='true']").forEach(b => b.setAttribute("aria-expanded","false"));
                }

                document.addEventListener("click", (e) => {
                  if (e.target.closest("#menu-toggle")) {
                    e.preventDefault();
                    menu.classList.contains("open") ? closeDrawer() : openDrawer();
                    return;
                  }
                  if (e.target === backdrop) {
                    closeDrawer();
                    return;
                  }
                  const subTrigger = e.target.closest(".has-submenu, .submenu-toggle");
                  if (subTrigger && isMobile()) {
                    e.preventDefault();
                    const li  = subTrigger.closest(".dropdown");
                    const btn = li && li.querySelector(".submenu-toggle");
                    const open = li && li.classList.toggle("open");
                    if (btn) btn.setAttribute("aria-expanded", String(open));
                  }
                }, { passive: false });

                window.addEventListener("keydown", (e) => {
                  if (e.key === "Escape" && menu.classList.contains("open")) closeDrawer();
                });
                window.addEventListener("resize", () => { if (!isMobile()) closeDrawer(); });
              })();
            }

            // Let header.js listen if needed
            window.dispatchEvent(new Event("header:ready"));
          })
          .catch(err => console.error("Failed to load header.html:", err));
      });
    </script>

    <!-- Main behavior (must be after the injector) -->
    <!-- Bump ?v= when you deploy a change to avoid cache issues -->
    <script src="./header.js?v=7" defer></script>
  </body>
</html>
